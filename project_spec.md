## AI DECLARANT — Полная спецификация приложения**


### Обзор приложения

AI DECLARANT — это веб-приложение, которое автоматически определяет и предлагает коды ТН ВЭД (Harmonized System, HS) для брокеров по таможенным операциям Туркменистана. Пользователь загружает файлы Excel или CSV с описаниями товаров; система обрабатывает макс до 1 000 позиций и выдает как минимум один код ТН ВЭД для каждой позиции с указанием уровня доверия.

---

## 1. Выбранный техстек и обоснование

| Слой                | Стек                                                     | Почему сейчас                                                                         | План «после MVP»                                                                                  |
| ------------------- | -------------------------------------------------------- | ------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- |
| **Backend API**     | **Python 3.12 + Django 5.0 LTS** + Django REST Framework | Дев‑скорость, богатая экосистема, готовые админ‑панели; асинхронность уже поддержана. | Возможна миграция на FastAPI‑сервисы для тяжёлых асинхронных задач.                               |
| **Фоновые задачи**  | Celery 5 + Redis                                         | Простая интеграция с Django, shared tasks для RAG‑потоков.                            | Перейти на RabbitMQ/Flower monitoring.                                                            |
| **Vector Store**    | Managed **OpenAI Vector Store**                          | Не требуются DevOps‑затраты, хранит эмбеддинги (до ≈10^6) «из коробки».               | При росте данных → self‑host Milvus на K8s + offline‑backup S3 (ежемесячный экспорт эмбеддингов). |
| **AI agents**             | openai-agents-python SDK (https://github.com/openai/openai-agents-python)                                      | Легко создать ИИ агентов для разных задач и можно оркестрация.                                                       | Улучшит свойства ИИ агента добавить дополнительные MCP Инструменты                                               |                                                       |
| **Хранение файлов** | VPS серверы (eu‑central‑1)                                    | Дёшево, просто, нет требования резиденции.                                            |                                                                |
| **SQL DB**          | PostgreSQL 16                                   | ACID, JSONB для логов, расширения pgvector пригодятся позже.                          | Read‑replica для отчётности.                                                                      |
| **Frontend (MVP)**  | **Streamlit**                                       | Чрезвычайно быстрый UI для формы «загрузить / скачать».                               | Миграция на Next.js + tRPC + shadcn/ui.                                                           |
| **Observability**   | Sentry (SaaS) + basic CloudWatch                         | Ошибки + alerting без настройки Prometheus.                                           | Добавить self‑host Prometheus + Grafana во второй фазе.                                           |
| **Infra & CI/CD**   | Docker, GitHub Actions, AWS ECS Fargate                  | Без K8s — дешевле и легче DevOps‑пол‑ставки.                                          | K8s (EKS) при росте нагрузки.                                                                     |



### Интерфейс и опыт пользователя

#### Главная панель (Dashboard)

* Чистый, профессиональный интерфейс с заметной зоной загрузки файлов
* Область drag-and-drop с поддержкой Excel (.xlsx, .xls) и CSV
* Проверка формата и размера файла при загрузке
* Индикатор прогресса текущих задач
* Раздел «История» с предыдущими загрузками и их статусом

#### Процесс загрузки файла

1. **Выбор файла:** перетаскивание или выбор через проводник
2. **Предпросмотр:** отображение первых 5-10 строк для проверки структуры
3. **Сопоставление колонок:** пользователь обозначает поля (название товара, описание, категория и т.д.)
4. **Подтверждение:** сводка с количеством позиций и оценочным временем обработки

#### Страница статуса обработки

* Реальный индикатор прогресса (в %)
* Счетчик «Обработано X из 1 000»
* Оставшееся время
* Текущий этап (поиск, проверка, рецензирование)
* Возможность отменить обработку

#### Панель результатов

**Сводная статистика**

* Всего обработано позиций
* Позиции с высокой уверенностью (> 80 %)
* Позиции, требующие проверки (< 60 %)
* Общее время обработки

**Таблица результатов** (с сортировкой/фильтрацией)

* Исходное описание товара
* Предложенный код ТН ВЭД
* Процент уверенности
* Альтернативные коды (если есть)
* Статус (подтверждено, требует проверки, неуверенно)

**Массовые действия**

* Принять все предложения с высокой уверенностью
* Пометить неуверенные позиции

**Экспорт**

* Выгрузка Excel/CSV с исходными данными и предложенными кодами

#### Просмотр отдельной позиции

* Полная информация о товаре
* Основной код с уровнем доверия
* До 3 альтернативных кодов с пояснениями
* Обоснование выбора
* Похожие товары из базы
* **Ручная корректировка:** выбор другого кода или отметка «на экспертный обзор»
* **Обратная связь:** лайк/дизлайк точности
* Поле для заметок

#### Система оповещений

* Высокий приоритет для позиций с уверенностью < 40 %
* Уведомления о необходимости ручной проверки
* Предупреждения о неподдерживаемых форматах или превышении лимитов
* E-mail-уведомление о завершении обработки (по желанию)

---

### Настройки и конфигурация

* **Предпочтения пользователя:** формат экспорта по умолчанию, уведомления
* **Шаблоны сопоставления колонок**
* **Параметры обработки:** пороги уверенности, включение/отключение веб-поиска
* **Учетная запись:** статистика использования, история обработок

---

### Рабочие процессы пользователя

1. **Стандартный процесс**

   * Вход ➔ загрузка файла ➔ предпросмотр ➔ сопоставление ➔ запуск ➔ мониторинг ➔ просмотр результатов ➔ корректировка ➔ экспорт.

2. **Процесс проверки и исправления**

   * Открытие завершенной задачи ➔ фильтрация по уровню уверенности ➔ индивидуальная проверка ➔ выбор альтернативы или запрос эксперта ➔ добавление заметок ➔ экспорт скорректированных данных.

3. **Пакетная обработка**

   * Одновременная загрузка нескольких файлов ➔ установка приоритета ➔ мониторинг ➔ уведомления ➔ раздельный экспорт.

---

### Ключевые функции

#### Интеллектуальное предложение кода

* Автоматический анализ описаний с помощью ИИ Агента
* Несколько алгоритмов подбора для большей полноты
* Оценка уверенности
* Альтернативные варианты

#### «Умный» поиск

* Семантический поиск по Векторной базе OpenaAI HS-кодов
* Веб-поиск через web_search tools для неизвестных товаров
* Обучение на обратной связи
* Контекстные предложения с учетом категории

#### Управление данными

* Безопасная загрузка и обработка
* Валидация данных и обработка ошибок
* История и аудит
* Экспорт только в формате xlsx/csv/xls

#### Повышение UX

* Интуитивный интерфейс, минимум обучения
* Обновления статуса в реальном времени
* Полная справка
* Адаптивный дизайн (desktop / tablet)

---

#### Обработка файлов

* Библиотеки для парсинга Excel/CSV
* Инструменты валидации данных

#### Фоновая обработка

* Система очередей задач
* Отслеживание прогресса

#### Хранение данных

* PostreSQL для хранение запрос и ответ файлов, данные пользователей и тд.
* Векторная БД для кодовой базы

---

### Требования к производительности

* Макс до 1 000 позиций одним запросом
* Минимум один код на позицию
* ≥ 80 % уверенности для основного кода
* Параллельная обработка нескольких файлов
* Отзывчивый интерфейс
* Генерация оповещений для позиций, требующих проверки
